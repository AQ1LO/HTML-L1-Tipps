<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Self-Service Troubleshooter</title>
<style>
  :root{--bg:#f7f7f8;--card:#fff;--border:#e5e7eb;--text:#0a0a0a;--muted:#6b7280;--accent:#111}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
  header{position:sticky;top:0;background:#ffffffcc;backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid var(--border)}
  .wrap{max-width:1040px;margin:0 auto;padding:14px 16px;display:flex;gap:10px;align-items:center}
  h1{font-size:18px;margin:0;font-weight:600}
  .right{margin-left:auto;display:flex;gap:8px}
  .btn{padding:10px 14px;border:1px solid var(--border);border-radius:12px;background:#fff;cursor:pointer}
  .btn:hover{background:#f3f4f6}
  main{max-width:1040px;margin:0 auto;padding:24px 16px;display:flex;flex-direction:column;gap:24px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
  .kicker{font-size:11px;letter-spacing:.12em;color:var(--muted);font-weight:700;text-transform:uppercase}
  .section-title{display:flex;gap:8px;align-items:center;margin-bottom:10px}
  .flex{display:flex;flex-wrap:wrap;gap:8px;max-height:260px;overflow:auto;padding-right:4px}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fff;cursor:pointer;white-space:nowrap}
  .chip:hover{background:#f9fafb}
  .chip.sel{background:var(--accent);color:#fff;border-color:var(--accent)}
  .input{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px}
  .muted{color:var(--muted);font-size:14px}
  .result h3{margin:.25rem 0 .5rem;font-size:16px}
  .result ul{margin:.25rem 0 .9rem;padding-left:1.15rem}
  footer{max-width:1040px;margin:0 auto;padding:24px 16px 40px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>üõ†Ô∏è Self-Service Troubleshooter</h1>
    <div class="right">
      <button id="reload" class="btn" title="daten.json neu einlesen">Daten neu laden</button>
      <button id="pickbtn" class="btn" title="JSON-Datei von deinem Computer laden">JSON laden</button>
      <input id="pickfile" type="file" accept="application/json" hidden>
      <button id="reset" class="btn">Zur√ºcksetzen</button>
    </div>
  </div>
</header>

<main>
  <!-- OBERER TEIL: dein frei editierbarer Text -->
  <section class="card">
    <h2>Willkommen beim Self-Service der PlusGarantie   </h2>
<p>
  W√§hlen Sie unten zuerst die <strong>Ger√§tegruppe</strong> und anschlie√üend das <strong>Symptom</strong>.
  Sie erhalten sofort m√∂gliche <strong>Ursachen</strong> und <strong>Selbsthilfe-Tipps</strong>, 
  damit Sie Ihr Ger√§t schnell wieder zum Laufen bringen.  
  In mehr als der H√§lfte aller F√§lle k√∂nnen wir unseren Kundinnen und Kunden so bereits direkt weiterhelfen ‚Äì 
  ganz ohne Technikerbesuch.  
  Falls das Problem dennoch bestehen bleibt: Bitte halten Sie bei einem Anruf Ihre <em>Vertragsnummer</em> 
  und ‚Äì sofern vorhanden ‚Äì die <em>Seriennummer</em> bereit.
</p>
  </section>

  <!-- UNTERER TEIL: der Troubleshooter -->
  <section class="card">
    <div class="section-title"><span class="kicker">Schritt 1</span><span>Ger√§tegruppe w√§hlen</span></div>
    <div id="devices" class="flex"></div>
  </section>

  <section class="card">
    <div class="section-title"><span class="kicker">Schritt 2</span><span>Symptom w√§hlen</span></div>
    <input id="symSearch" class="input" placeholder="Symptom suchen (z. B. ‚Äûpumpt nicht ab‚Äú)" />
    <div id="symptoms" class="flex" style="margin-top:10px"></div>
    <p id="symHint" class="muted" style="margin-top:8px">Bitte zuerst ein Ger√§t ausw√§hlen.</p>
  </section>

  <section class="card">
    <div class="section-title"><span class="kicker">Ergebnis</span><span>Ursachen & Selbsthilfe-Tipps</span></div>
    <div id="result" class="result muted">Bitte Ger√§t und Symptom ausw√§hlen.</div>
  </section>
</main>

<footer>¬© <span id="yr"></span> ‚Äì Bereitgestellt als statische Website.</footer>

<script>
/* ===== Kurz-Utilities ===== */
const $ = s => document.querySelector(s);
const normalize = s => (s||"").toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"");

function validateData(json){
  if (!Array.isArray(json)) throw new Error("Root muss ein Array sein");
  json.forEach(d=>{
    if (typeof d.device!=="string" || !Array.isArray(d.items)) throw new Error("Ung√ºltiges Device-Objekt");
    d.items.forEach(i=>{
      if (typeof i.symptom!=="string" || !Array.isArray(i.causes) || !Array.isArray(i.tips)){
        throw new Error("Ung√ºltiger Item-Eintrag");
      }
    });
  });
}

/* ===== Demo-Fallback (falls keine daten.json geladen wird) ===== */
const DEMO = [
  {"device":"Geschirrsp√ºler","items":[
    {"symptom":"pumpt nicht ab","causes":["Fremdk√∂rper in der Pumpe","Ablauf verstopft / blockiert"],"tips":["Siebe kontrollieren und reinigen","Ablaufschlauch am Syphon l√∂sen (ACHTUNG! Druck!)","Ablaufschlauch auf Knicke pr√ºfen"]},
    {"symptom":"w√§scht nicht sauber","causes":["Falsche Dosierung","Falsche Einstellung"],"tips":["Dosierung & Wasserh√§rte gem√§√ü Anleitung einhalten"]}
  ]},
  {"device":"Herd","items":[
    {"symptom":"Kochplatte/Rohr geht nicht","causes":["Uhr nicht eingestellt"],"tips":["Uhr einstellen"]}
  ]},
  {"device":"Kaffeemaschine","items":[
    {"symptom":"es kommt kein Wasser","causes":["Verkalkt","Verstopft"],"tips":["Entkalkungs-/Reinigungsprogramm","Ausl√§sse reinigen"]},
    {"symptom":"Milchsch√§umer geht nicht","causes":["Verstopft"],"tips":["√ñffnung mit Pfeifenreiniger reinigen"]}
  ]},
  {"device":"K√ºhlschrank","items":[
    {"symptom":"Wasser steht im Ger√§t","causes":["Abtaurinne verstopft"],"tips":["Abfluss√∂ffnung reinigen"]}
  ]},
  {"device":"K√ºhlschrank-Kombi","items":[
    {"symptom":"k√ºhlt nicht","causes":["Umgebungstemperatur zu k√ºhl"],"tips":["Raumtemperatur > 15 ¬∞C sicherstellen"]}
  ]},
  {"device":"TV","items":[
    {"symptom":"Bild farbfleckig","causes":["Clouding"],"tips":["Auf gute Bel√ºftung achten"]},
    {"symptom":"Bild hat Farbstich","causes":["HDMI/Scart defekt","Zuspielger√§t defekt"],"tips":["Anderes Kabel/Ger√§t/Eingang testen"]},
    {"symptom":"kein Bild","causes":["HDMI/Scart defekt","Zuspielger√§t defekt","Karte aktiv?"],"tips":["Anderes Kabel/Ger√§t/Eingang testen"]}
  ]},
  {"device":"Waschmaschine","items":[
    {"symptom":"pumpt nicht ab","causes":["Fremdk√∂rper im Flusensieb","Ablauf verstopft/Blockade"],"tips":["Flusensieb reinigen (ACHTUNG: Restwasser!)","Ablaufschlauch auf Knicke pr√ºfen"]},
    {"symptom":"h√ºpft beim Schleudern","causes":["Ger√§t steht nicht richtig","Transportsicherungen","Unwucht"],"tips":["Ger√§t ausrichten","Transportsicherungen entfernen","W√§schemenge anpassen"]}
  ]},
  {"device":"Trockner","items":[
    {"symptom":"zeigt ‚ÄûBeh√§lter voll‚Äú","causes":["Flusensiebe verstopft"],"tips":["Siebe reinigen"]}
  ]}
];

/* ===== State ===== */
let DATA = DEMO.slice();
let selectedDevice = null;
let selectedSymptom = null;
let symQuery = "";

/* ===== Rendering ===== */
function renderDevices(){
  const box = $("#devices"); box.innerHTML = "";
  [...DATA.map(d=>d.device)].sort((a,b)=>a.localeCompare(b)).forEach(name=>{
    const b = document.createElement("button");
    b.className = "chip"+(selectedDevice===name?" sel":"");
    b.textContent = name;
    b.onclick = ()=>{
      selectedDevice=name; selectedSymptom=null; symQuery=""; $("#symSearch").value="";
      renderDevices(); renderSymptoms(); renderResult();
    };
    box.appendChild(b);
  });
}

function listSymptoms(){
  const dev = DATA.find(d=>d.device===selectedDevice);
  if (!dev) return [];
  let items = dev.items;
  if (symQuery){
    const q = normalize(symQuery);
    items = items.filter(i => normalize(i.symptom).includes(q));
  }
  return [...items].sort((a,b)=>a.symptom.localeCompare(b.symptom));
}

function renderSymptoms(){
  const hint = $("#symHint");
  const box = $("#symptoms"); box.innerHTML = "";
  hint.style.display = selectedDevice ? "none" : "block";
  if (!selectedDevice) return;
  listSymptoms().forEach(i=>{
    const b = document.createElement("button");
    b.className = "chip"+(selectedSymptom===i.symptom?" sel":"");
    b.textContent = i.symptom;
    b.onclick = ()=>{ selectedSymptom=i.symptom; renderSymptoms(); renderResult(); };
    box.appendChild(b);
  });
}

function renderResult(){
  const out = $("#result");
  if (!selectedDevice || !selectedSymptom){
    out.classList.add("muted");
    out.textContent = "Bitte Ger√§t und Symptom ausw√§hlen.";
    return;
  }
  const dev = DATA.find(d=>d.device===selectedDevice);
  const item = dev?.items.find(i=>i.symptom===selectedSymptom);
  if (!item){ out.textContent = "Keine Daten gefunden."; return; }
  out.classList.remove("muted");
  out.innerHTML = `
    <h3>üîß ${selectedDevice} ‚Äì ${selectedSymptom}</h3>
    <strong>M√∂gliche Ursachen</strong>
    <ul>${item.causes.map(c=>`<li>${c}</li>`).join("")}</ul>
    <strong>Selbsthilfe-Tipps</strong>
    <ul>${item.tips.map(t=>`<li>${t}</li>`).join("")}</ul>
    ${item.info ? `<div class="muted" style="margin-top:.5rem">${item.info}</div>` : ""}
  `;
}

/* ===== daten.json automatisch laden (wenn vorhanden) ===== */
async function tryLoadJson(){
  try{
    const res = await fetch("daten.json",{cache:"no-store"});
    if(!res.ok) throw 0;
    const json = await res.json();
    validateData(json);
    DATA = json;
    console.log("daten.json geladen ‚úÖ");
  }catch{
    console.warn("daten.json nicht gefunden oder ung√ºltig ‚Äì Demo-Daten aktiv.");
    DATA = DEMO.slice();
  }
}

/* ===== Datei-Picker (lokal ohne Server) ===== */
function readJsonFile(file){
  return new Promise((resolve,reject)=>{
    const fr=new FileReader();
    fr.onload=()=>{ try{ const j=JSON.parse(fr.result); validateData(j); resolve(j); }catch(e){ reject(e); } };
    fr.onerror=()=>reject(fr.error);
    fr.readAsText(file,"utf-8");
  });
}

/* ===== Events & Init ===== */
$("#pickbtn").onclick = ()=> $("#pickfile").click();
$("#pickfile").onchange = async e=>{
  const f = e.target.files?.[0]; if(!f) return;
  try{
    DATA = await readJsonFile(f);
    selectedDevice=null; selectedSymptom=null; symQuery=""; $("#symSearch").value="";
    renderDevices(); renderSymptoms(); renderResult();
    alert("JSON geladen ‚úÖ");
  }catch(err){
    alert("JSON ung√ºltig: " + (err?.message || err));
  }finally{
    e.target.value="";
  }
};

$("#reload").onclick = async ()=>{
  await tryLoadJson();
  selectedDevice=null; selectedSymptom=null; symQuery=""; $("#symSearch").value="";
  renderDevices(); renderSymptoms(); renderResult();
};

$("#reset").onclick = ()=>{
  selectedDevice=null; selectedSymptom=null; symQuery=""; $("#symSearch").value="";
  renderDevices(); renderSymptoms(); renderResult();
};

$("#symSearch").oninput = e=>{ symQuery=e.target.value; renderSymptoms(); };

(async function init(){
  $("#yr").textContent = new Date().getFullYear();
  await tryLoadJson();                 // versucht daten.json zu laden, sonst DEMO
  renderDevices(); renderSymptoms(); renderResult();
})();
</script>
</body>
</html>
